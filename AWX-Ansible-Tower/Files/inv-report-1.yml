---
- hosts: localhost
  gather_facts: no
  become: yes
  become_method: sudo

  tasks:
    - name: Execute Python Script To Get Inventory Report
      command: python awx_inv.py
      register: invrep

    - name: print inv report
      debug: msg="invrep"

    - name: Date fact
      debug:
        msg: "{{ lookup('pipe','date +%Y-%m-%d') }}"

    - name: Send e-mail to a bunch of users, attaching files
      mail:
        host: smtp.gmail.com
        port: 587
        username: rm@gh.com
        password: password
        subject: Ansible Inventory Report {{ lookup('pipe','date +%Y-%m-%d') }}
        body: Hello, Inventory Report CSV File 
        from: s2@gmail.com (Ravi Sravanam)
        to: Srvi <s2@gmail.com>
        cc: Ravi S <rm@ch.com>
        attach: ./Inventory-Report-{{ lookup('pipe','date +%Y-%m-%d') }}.csv
      delegate_to: localhost

